<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pheta Page</title>
  <style>
    body {
      margin: 0;
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #fdf6d3, #f7e17d); 
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      position: relative;
      touch-action: none; /* Prevents scrolling while dragging on mobile */
    }

    .container1 {
      width: 300px;
      height: 350px;
      margin: 70px auto; 
      position: relative;
      border: 4px solid black;
      border-radius: 5px;
      overflow: hidden;
      touch-action: none; /* Prevents scrolling while dragging on mobile */
    }

    .img1 {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
    }
    
    .drag-overlay {
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
    }
    
    .resize-handle {
      background-color: #fff;
      border: 2px solid #007bff;
      width: 12px !important;
      height: 12px !important;
      border-radius: 50%;
      z-index: 100;
    }

    .btn1 {
      flex: 1 0 130px;
      max-width: 120px;
      height: 120px;
      padding: 0;
      border: 3px solid #b8860b;
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.3s;
      overflow: hidden;
    }

    .btn1 img.btn-img {
      width: 100%;
      height: 100%;
      object-fit: cover; 
      border-radius: 8px;
      box-shadow: 0px 4px 10px rgba(188, 39, 39, 0.2);
    }

    .btn1:hover {
      transform: scale(1.1);
      box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.3);
    }

    .btn1:active {
      transform: scale(0.9);
      box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);
    }

    .flex1 {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 60px;
      max-width: 720px;
    }

    .bottom-buttons {
      width: 100%;
      position: fixed;
      bottom: 20px;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
    }

    .nav-btn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      color: white;
    }

    .skip-btn { background: #007bff; }
    .next-btn { background: #0056b3; }
    .skip-btn:hover { background: #0056b3; }
    .next-btn:hover { background: #004080; }
  </style>
</head>
<body>

  <div class="container1">
    <img src="" alt="Background" class="img1" id="murtiImage">
  </div>

  <div class="flex1">
    <button class="btn1"><img src="P2.png" alt="P2" class="btn-img"></button>
    <button class="btn1"><img src="P4.png" alt="P4" class="btn-img"></button>
    <button class="btn1"><img src="P7.png" alt="P7" class="btn-img"></button>
    <button class="btn1"><img src="P8.png" alt="P8" class="btn-img"></button>
    <button class="btn1"><img src="P9.png" alt="P9" class="btn-img"></button>
    <button class="btn1"><img src="P10.png" alt="P10" class="btn-img"></button>
    <button class="btn1"><img src="P11.png" alt="P11" class="btn-img"></button>
    <button class="btn1"><img src="P12.png" alt="P12" class="btn-img"></button>
    <button class="btn1"><img src="P13.png" alt="P13" class="btn-img"></button>
    <button class="btn1"><img src="P5.png" alt="P5" class="btn-img"></button>
    <button class="btn1"><img src="P6.png" alt="P6" class="btn-img"></button>
    <button class="btn1"><img src="P14.png" alt="P14" class="btn-img"></button>
    <button class="btn1"><img src="P15.png" alt="P15" class="btn-img"></button>
  </div>

  <div class="bottom-buttons">
    <button class="nav-btn skip-btn" onclick="skipNext()">Skip</button>
    <button class="nav-btn next-btn" onclick="goNext()">Next</button>
  </div>

  <div id="adjustmentControls" style="display: none; position: fixed; top: 10px; right: 10px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 1000;">
    <div style="margin-bottom: 10px; font-weight: bold;">Adjust Pheta Position</div>
    <div>
      <label>Top: <input type="number" id="adjustTop" style="width: 60px;" step="1" value="0"> px</label>
    </div>
    <div>
      <label>Left: <input type="number" id="adjustLeft" style="width: 60px;" step="1" value="0"> px</label>
    </div>
    <div>
      <label>Width: <input type="number" id="adjustWidth" style="width: 60px;" step="5" value="100"> px</label>
    </div>
    <div>
      <label>Height: <input type="number" id="adjustHeight" style="width: 60px;" step="5" value="100"> px</label>
    </div>
    <div style="margin-top: 10px;">
      <button id="btnApplyAdjustment" style="padding: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">Apply</button>
      <button id="btnShowCode" style="padding: 5px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;">Get Code</button>
      <button id="btnCopyPositionOnly" style="padding: 5px; background: #9c27b0; color: white; border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;">Copy Position Only</button>
      <button id="btnToggleControls" style="padding: 5px; background: #6c757d; color: white; border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;">Hide</button>
    </div>
    <div style="margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;">
      <div style="font-weight: bold;">Batch Alignment</div>
      <div>
        <button id="btnBatchAlignTop" style="padding: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; margin: 5px 0;">Align Center</button>
        <button id="btnSaveForAllMurtis" style="padding: 5px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;">Save For All Murtis</button>
      </div>
    </div>
    <div id="codeOutput" style="margin-top: 10px; padding: 5px; background: #f8f9fa; border-radius: 3px; display: none; max-width: 300px; word-break: break-all;">
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const murti = params.get("img") || "Murti_Images/G17.jpg";
    document.getElementById("murtiImage").src = murti;

    // Default positioning that will be used for any Ganpati image without specific settings
    const defaultPositioning = {
      P2: { top: "-15px", left: "110px", width: "85px", height: "93px" },
      P4: { top: "-20px", left: "100px", width: "130px", height: "100px" },
      P7: { top: "-25px", left: "100px", width: "125px", height: "100px" },
      P8: { top: "-20px", left: "100px", width: "115px", height: "100px" },
      P9: { top: "-25px", left: "95px", width: "130px", height: "100px" },
      P10: { top: "-25px", left: "95px", width: "130px", height: "100px" },
      P11: { top: "-50px", left: "90px", width: "120px", height: "150px" },
      P12: { top: "-22px", left: "65px", width: "180px", height: "210px" },
      P13: { top: "-20px", left: "65px", width: "180px", height: "210px" },
      P5: { top: "-15px", left: "75px", width: "150px", height: "180px" },
      P6: { top: "-10px", left: "80px", width: "140px", height: "170px" },
      P14: { top: "-18px", left: "70px", width: "160px", height: "190px" },
      P15: { top: "-22px", left: "65px", width: "180px", height: "210px" }
    };

    // Specific positioning for different Ganpati images
    const overlayPositions = {
      // Original G16 positioning
      "Murti_Images/G17.jpg": {
        P2: { top: "-20px", left: "95px", width: "85px", height: "93px" },
        P4: { top: "-20px", left: "80px", width: "130px", height: "100px" },
        P7: { top: "-25px", left: "85px", width: "130px", height: "100px" },
        P8: { top: "-20px", left: "90px", width: "115px", height: "100px" },
        P9: { top: "-35px", left: "80px", width: "130px", height: "100px" },
        P10: { top: "-34px", left: "87px", width: "122px", height: "95px" },
        P11: { top: "-15px", left: "87px", width: "110px", height: "82px" },
        P12: { top: "-50px", left: "96px", width: "85px", height: "120px" },
        P13: { top: "-26px", left: "77px", width: "109px", height: "98px" },
        P5: { top: "-11px", left: "80px", width: "102px", height: "84px" },
        P6: { top: "-26px", left: "95px", width: "95px", height: "96px" },
        P14: { top: "-28px", left: "95px", width: "132px", height: "102px" },
        P15: { top: "-15px", left: "96px", width: "105px", height: "82px" }
      },
      // Original G1 positioning
      "Murti_Images/G1.jpg": {
        P2: { top: "-7px", left: "43px", width: "85px", height: "93px" },
        P4: { top: "-20px", left: "38px", width: "130px", height: "100px" },
        P7: { top: "-25px", left: "45px", width: "125px", height: "100px" },
        P8: { top: "-20px", left: "44px", width: "115px", height: "100px" },
        P9: { top: "-12px", left: "20px", width: "150px", height: "180px" },
        P10: { top: "-8px", left: "30px", width: "130px", height: "160px" },
        P11: { top: "-18px", left: "15px", width: "160px", height: "190px" },
        P12: { top: "-22px", left: "10px", width: "180px", height: "210px" },
        P13: { top: "-20px", left: "10px", width: "180px", height: "210px" },
        P5: { top: "-15px", left: "20px", width: "150px", height: "180px" },
        P6: { top: "-10px", left: "25px", width: "140px", height: "170px" },
        P14: { top: "-18px", left: "15px", width: "160px", height: "190px" },
        P15: { top: "-22px", left: "10px", width: "180px", height: "210px" }
      },
      // Original G3 positioning
      "Murti_Images/G3.jpg": {
        P2: { top: "-7px", left: "43px", width: "85px", height: "93px" },
        P4: { top: "-20px", left: "38px", width: "130px", height: "100px" },
        P7: { top: "-25px", left: "45px", width: "125px", height: "100px" },
        P8: { top: "-20px", left: "44px", width: "115px", height: "100px" },
        P9: { top: "-12px", left: "20px", width: "150px", height: "180px" },
        P10: { top: "-8px", left: "30px", width: "130px", height: "160px" },
        P11: { top: "-18px", left: "15px", width: "160px", height: "190px" },
        P12: { top: "-22px", left: "10px", width: "180px", height: "210px" },
        P13: { top: "-20px", left: "10px", width: "180px", height: "210px" },
        P5: { top: "-15px", left: "20px", width: "150px", height: "180px" },
        P6: { top: "-10px", left: "25px", width: "140px", height: "170px" },
        P14: { top: "-18px", left: "15px", width: "160px", height: "190px" },
        P15: { top: "-22px", left: "10px", width: "180px", height: "210px" }
      },
      // Added positioning for more Ganpati images
      "Murti_Images/G2.jpg": {
        P2: { top: "-10px", left: "105px", width: "85px", height: "93px" },
        P4: { top: "-15px", left: "95px", width: "130px", height: "100px" },
        P7: { top: "-20px", left: "100px", width: "125px", height: "100px" },
        P8: { top: "-15px", left: "95px", width: "115px", height: "100px" },
        P9: { top: "-30px", left: "95px", width: "130px", height: "100px" },
        P10: { top: "-30px", left: "95px", width: "130px", height: "100px" },
        P11: { top: "-60px", left: "85px", width: "120px", height: "150px" },
        P12: { top: "-22px", left: "60px", width: "180px", height: "210px" },
        P13: { top: "-20px", left: "60px", width: "180px", height: "210px" },
        P5: { top: "-15px", left: "70px", width: "150px", height: "180px" },
        P6: { top: "-10px", left: "75px", width: "140px", height: "170px" },
        P14: { top: "-18px", left: "65px", width: "160px", height: "190px" },
        P15: { top: "-22px", left: "60px", width: "180px", height: "210px" }
      },
      "Murti_Images/G4.jpg": {
        P2: { top: "-15px", left: "115px", width: "85px", height: "93px" },
        P4: { top: "-20px", left: "105px", width: "130px", height: "100px" },
        P7: { top: "-25px", left: "110px", width: "125px", height: "100px" },
        P8: { top: "-20px", left: "110px", width: "115px", height: "100px" },
        P9: { top: "-30px", left: "105px", width: "130px", height: "100px" },
        P10: { top: "-30px", left: "105px", width: "130px", height: "100px" },
        P11: { top: "-60px", left: "100px", width: "120px", height: "150px" },
        P12: { top: "-22px", left: "70px", width: "180px", height: "210px" },
        P13: { top: "-20px", left: "70px", width: "180px", height: "210px" },
        P5: { top: "-15px", left: "80px", width: "150px", height: "180px" },
        P6: { top: "-10px", left: "85px", width: "140px", height: "170px" },
        P14: { top: "-18px", left: "75px", width: "160px", height: "190px" },
        P15: { top: "-22px", left: "70px", width: "180px", height: "210px" }
      },
      "Murti_Images/G5.jpg": {
        P2: { top: "-10px", left: "110px", width: "85px", height: "93px" },
        P4: { top: "-15px", left: "100px", width: "130px", height: "100px" },
        P7: { top: "-20px", left: "105px", width: "125px", height: "100px" },
        P8: { top: "-15px", left: "105px", width: "115px", height: "100px" },
        P9: { top: "-25px", left: "100px", width: "130px", height: "100px" },
        P10: { top: "-25px", left: "100px", width: "130px", height: "100px" },
        P11: { top: "-55px", left: "95px", width: "120px", height: "150px" },
        P12: { top: "-22px", left: "65px", width: "180px", height: "210px" },
        P13: { top: "-20px", left: "65px", width: "180px", height: "210px" },
        P5: { top: "-15px", left: "75px", width: "150px", height: "180px" },
        P6: { top: "-10px", left: "80px", width: "140px", height: "170px" },
        P14: { top: "-18px", left: "70px", width: "160px", height: "190px" },
        P15: { top: "-22px", left: "65px", width: "180px", height: "210px" }
      }
    };

    function showOverlay(imgSrc, overlayKey) {
      const container = document.querySelector('.container1');

      // Remove all existing overlays before adding new one
      const existingOverlays = container.querySelectorAll('.drag-overlay, .resize-handle');
      existingOverlays.forEach(el => container.removeChild(el));

      // Create wrapper for overlay to handle drag operations
      const wrapper = document.createElement('div');
      wrapper.className = 'drag-overlay';
      wrapper.style.position = 'absolute';
      wrapper.style.cursor = 'move';
      wrapper.style.zIndex = '10'; // Ensure it's above the background image

      // Create actual overlay image
      let overlay = document.createElement('img');
      overlay.src = imgSrc;
      overlay.setAttribute("data-key", overlayKey);
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.userSelect = 'none';
      overlay.style.pointerEvents = 'none'; // Let mouse events pass to wrapper
      overlay.draggable = false; // Prevent default HTML5 drag
      
      // Add image to wrapper
      wrapper.appendChild(overlay);
      
      // Get positions from specific Ganpati image settings or use default
      let pos;
      if (overlayPositions[murti] && overlayPositions[murti][overlayKey]) {
        pos = overlayPositions[murti][overlayKey];
      } else {
        // Use default positioning if specific positioning is not available
        pos = defaultPositioning[overlayKey];
        console.log(`Using default positioning for ${murti} with ${overlayKey}`);
      }
      
      wrapper.style.top = pos.top;
      wrapper.style.left = pos.left;
      wrapper.style.width = pos.width;
      wrapper.style.height = pos.height;

      // Add the wrapper to the container
      container.appendChild(wrapper);
      
      // Add resize handles
      addResizeHandles(wrapper);
      
      // Make it draggable
      makeDraggable(wrapper);
      
      // Update the position controls
      updateControlsFromOverlay(wrapper);
      
      // Show control panel
      const controls = document.getElementById('adjustmentControls');
      controls.style.display = 'block';
    }
    
    function addResizeHandles(element) {
      const positions = ['nw', 'ne', 'sw', 'se'];
      const cursors = ['nwse-resize', 'nesw-resize', 'nesw-resize', 'nwse-resize'];
      
      positions.forEach((pos, index) => {
        const handle = document.createElement('div');
        handle.className = 'resize-handle ' + pos;
        handle.style.position = 'absolute';
        handle.style.width = '10px';
        handle.style.height = '10px';
        handle.style.background = '#ffffff';
        handle.style.border = '1px solid #000000';
        handle.style.cursor = cursors[index];
        handle.style.zIndex = '1000';
        
        // Position the handle
        if (pos.includes('n')) {
          handle.style.top = '-5px';
        } else {
          handle.style.bottom = '-5px';
        }
        
        if (pos.includes('w')) {
          handle.style.left = '-5px';
        } else {
          handle.style.right = '-5px';
        }
        
        // Make the handle resizable
        handle.addEventListener('mousedown', function(e) {
          e.stopPropagation();
          makeResizable(element, pos, e);
        });
        
        element.appendChild(handle);
      });
    }
    
    function makeDraggable(element) {
      let offsetX, offsetY, isDragging = false;
      
      element.addEventListener('mousedown', function(e) {
        // Only handle drag on the element itself or the image inside it, not on resize handles
        if (e.target.classList.contains('resize-handle')) return;
        
        isDragging = true;
        const rect = element.getBoundingClientRect();
        const containerRect = document.querySelector('.container1').getBoundingClientRect();
        
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        
        // Add these event listeners to document, not to the element
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
        
        e.preventDefault(); // Prevent text selection
        e.stopPropagation(); // Stop event from bubbling up
      });
      
      function onMouseMove(e) {
        if (!isDragging) return;
        
        const containerRect = document.querySelector('.container1').getBoundingClientRect();
        let newLeft = e.clientX - containerRect.left - offsetX;
        let newTop = e.clientY - containerRect.top - offsetY;
        
        // Ensure element stays within container bounds
        if (newLeft < -element.offsetWidth / 2) newLeft = -element.offsetWidth / 2;
        if (newTop < -element.offsetHeight / 2) newTop = -element.offsetHeight / 2;
        if (newLeft > containerRect.width - element.offsetWidth / 2) 
          newLeft = containerRect.width - element.offsetWidth / 2;
        if (newTop > containerRect.height - element.offsetHeight / 2) 
          newTop = containerRect.height - element.offsetHeight / 2;
        
        // Update element position
        element.style.left = newLeft + 'px';
        element.style.top = newTop + 'px';
        
        // Update the position in the controls
        updateControlsFromOverlay(element);
        
        e.preventDefault();
        e.stopPropagation();
      }
      
      function onMouseUp(e) {
        if (!isDragging) return;
        
        isDragging = false;
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        
        e.preventDefault();
        e.stopPropagation();
      }
    }
    
    function makeResizable(element, direction, startEvent) {
      const container = document.querySelector('.container1');
      const containerRect = container.getBoundingClientRect();
      const startRect = element.getBoundingClientRect();
      
      const startX = startEvent.clientX;
      const startY = startEvent.clientY;
      
      const startWidth = startRect.width;
      const startHeight = startRect.height;
      const startLeft = parseInt(element.style.left || "0");
      const startTop = parseInt(element.style.top || "0");
      
      let isDragging = true;
      
      function onMouseMove(e) {
        if (!isDragging) return;
        
        // Calculate width and height based on direction
        let newWidth = startWidth;
        let newHeight = startHeight;
        let newLeft = startLeft;
        let newTop = startTop;
        
        // Handle horizontal resize
        if (direction.includes('e')) {
          newWidth = startWidth + (e.clientX - startX);
        } else if (direction.includes('w')) {
          newWidth = startWidth - (e.clientX - startX);
          newLeft = startLeft + (e.clientX - startX);
        }
        
        // Handle vertical resize
        if (direction.includes('s')) {
          newHeight = startHeight + (e.clientY - startY);
        } else if (direction.includes('n')) {
          newHeight = startHeight - (e.clientY - startY);
          newTop = startTop + (e.clientY - startY);
        }
        
        // Apply the new dimensions (with minimum constraints)
        if (newWidth >= 20) {
          element.style.width = newWidth + 'px';
          element.style.left = newLeft + 'px';
        }
        
        if (newHeight >= 20) {
          element.style.height = newHeight + 'px';
          element.style.top = newTop + 'px';
        }
        
        // Update the controls
        updateControlsFromOverlay(element);
        
        e.preventDefault();
        e.stopPropagation();
      }
      
      function onMouseUp(e) {
        if (!isDragging) return;
        
        isDragging = false;
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        
        e.preventDefault();
        e.stopPropagation();
      }
      
      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
      
      startEvent.preventDefault(); // Prevent text selection
      startEvent.stopPropagation(); // Stop event bubbling
    }

    const buttons = document.getElementsByClassName('btn1');
    const keys = ["P2","P4","P7","P8","P9","P10","P11","P12","P13","P5","P6","P14","P15"];
    for (let i = 0; i < buttons.length; i++) {
      buttons[i].addEventListener('click', () => showOverlay(keys[i]+".png", keys[i]));
    }

    function mergeImages(includeOverlays) {
  const murtiImg = document.getElementById("murtiImage");
  const overlayWrappers = document.querySelectorAll('.container1 .drag-overlay');

  const container = document.querySelector('.container1');
  const canvas = document.createElement('canvas');
  canvas.width = container.offsetWidth;   // 300
  canvas.height = container.offsetHeight; // 350
  const ctx = canvas.getContext('2d');

  // Draw the Ganpati image
  ctx.drawImage(murtiImg, 0, 0, canvas.width, canvas.height);

  if (includeOverlays && overlayWrappers.length > 0) {
    overlayWrappers.forEach(wrapper => {
      const overlay = wrapper.querySelector('img');
      const wrapperStyle = getComputedStyle(wrapper);
      
      // Draw the pheta
      ctx.drawImage(
        overlay,
        parseInt(wrapperStyle.left),
        parseInt(wrapperStyle.top),
        parseInt(wrapperStyle.width),
        parseInt(wrapperStyle.height)
      );
    });
  }

  localStorage.setItem("mergedMurti", canvas.toDataURL("image/png"));
  window.location.href = "NextPage.html";
}

    function goNext() { mergeImages(true); }
    function skipNext() { mergeImages(false); }

    // Add keyboard shortcut to show/hide adjustment controls
    document.addEventListener('keydown', function(e) {
      // Press Alt+A to toggle adjustment controls
      if (e.altKey && e.key === 'a') {
        const controls = document.getElementById('adjustmentControls');
        controls.style.display = controls.style.display === 'none' ? 'block' : 'none';
      }
    });

    // Adjustment controls functionality
    document.getElementById('btnToggleControls').addEventListener('click', function() {
      const controls = document.getElementById('adjustmentControls');
      controls.style.display = 'none';
    });

    document.getElementById('btnApplyAdjustment').addEventListener('click', function() {
      const overlay = document.querySelector('.container1 .drag-overlay');
      if (!overlay) {
        showInlineMessage('Please select a pheta first!');
        return;
      }
      
      const top = document.getElementById('adjustTop').value;
      const left = document.getElementById('adjustLeft').value;
      const width = document.getElementById('adjustWidth').value;
      const height = document.getElementById('adjustHeight').value;
      
      overlay.style.top = top + 'px';
      overlay.style.left = left + 'px';
      overlay.style.width = width + 'px';
      overlay.style.height = height + 'px';
      
      showInlineMessage('Position updated');
    });

    document.getElementById('btnShowCode').addEventListener('click', function() {
      const overlay = document.querySelector('.container1 .drag-overlay');
      if (!overlay) {
        showInlineMessage('Please select a pheta first!');
        return;
      }

      const overlayKey = overlay.querySelector('img').getAttribute('data-key');
      const style = getComputedStyle(overlay);
      const murtiName = document.getElementById('murtiImage').src.split('/').pop();
      
      // Generate just the simple position code format
      const simpleCode = `${overlayKey}: { top: "${style.top}", left: "${style.left}", width: "${style.width}", height: "${style.height}" }`;
      
      // Also log to console for easy copy-paste
      console.log('Simple Position Code:');
      console.log(simpleCode);
      
      // Display the code in the UI
      const codeOutput = document.getElementById('codeOutput');
      codeOutput.textContent = simpleCode;
      codeOutput.style.display = 'block';
      
      // Copy to clipboard without popup
      navigator.clipboard.writeText(simpleCode).then(() => {
        showInlineMessage('✓ Position code copied to clipboard!');
      }).catch(err => {
        console.error('Could not copy text: ', err);
        showInlineMessage('Code displayed above (copy manually)');
      });
    });

    // Initialize adjustment controls
    const adjustControls = document.getElementById('adjustmentControls');
    
    // Update controls when a pheta is selected or moved
    function updateControlsFromOverlay(overlay) {
      if (!overlay) return;
      
      const style = getComputedStyle(overlay);
      
      // Parse values to get clean integers (removing 'px' suffix)
      let topValue = style.top;
      let leftValue = style.left;
      
      // Handle negative values correctly
      if (topValue.includes('-')) {
        document.getElementById('adjustTop').value = -parseInt(topValue.replace('-', ''));
      } else {
        document.getElementById('adjustTop').value = parseInt(topValue);
      }
      
      if (leftValue.includes('-')) {
        document.getElementById('adjustLeft').value = -parseInt(leftValue.replace('-', ''));
      } else {
        document.getElementById('adjustLeft').value = parseInt(leftValue);
      }
      
      document.getElementById('adjustWidth').value = parseInt(style.width);
      document.getElementById('adjustHeight').value = parseInt(style.height);
      
      adjustControls.style.display = 'block';
    }

    // Listen for pheta selection
    document.addEventListener('click', function(e) {
      if (e.target.closest('.btn1')) {
        // Wait a bit for the overlay to be created
        setTimeout(() => {
          const overlay = document.querySelector('.container1 .drag-overlay');
          updateControlsFromOverlay(overlay);
        }, 100);
      }
    });

    // Copy Position Only button - copies just the position values in format: { top: "-4px", left: "81px", width: "113px", height: "69px" }
    document.getElementById('btnCopyPositionOnly').addEventListener('click', function() {
      const overlay = document.querySelector('.container1 .drag-overlay');
      if (!overlay) {
        showInlineMessage('Please select a pheta first!');
        return;
      }
      
      const style = getComputedStyle(overlay);
      const positionCode = `{ top: "${style.top}", left: "${style.left}", width: "${style.width}", height: "${style.height}" }`;
      
      // Display the position in the code output area
      const codeOutput = document.getElementById('codeOutput');
      codeOutput.textContent = positionCode;
      codeOutput.style.display = 'block';
      
      // Copy to clipboard
      navigator.clipboard.writeText(positionCode).then(() => {
        showInlineMessage('✓ Position values copied to clipboard!');
      }).catch(err => {
        console.error('Could not copy text: ', err);
        showInlineMessage('Position values displayed above (copy manually)');
      });
    });
    
    // Batch center alignment
    document.getElementById('btnBatchAlignTop').addEventListener('click', function() {
      const overlay = document.querySelector('.container1 .drag-overlay');
      if (!overlay) {
        showInlineMessage('Please select a pheta first!');
        return;
      }

      // Get the container dimensions
      const container = document.querySelector('.container1');
      const containerRect = container.getBoundingClientRect();
      
      // Get the overlay dimensions
      const overlayStyle = getComputedStyle(overlay);
      const overlayWidth = parseInt(overlayStyle.width);
      
      // Calculate center position (horizontally)
      const centerLeft = (containerRect.width - overlayWidth) / 2;
      
      // Apply center alignment
      overlay.style.left = centerLeft + 'px';
      
      // Update controls
      updateControlsFromOverlay(overlay);
    });

    // Save positioning for all Murti images
    document.getElementById('btnSaveForAllMurtis').addEventListener('click', function() {
      const overlay = document.querySelector('.container1 .drag-overlay');
      if (!overlay) {
        showInlineMessage('Please select a pheta first!');
        return;
      }

      const overlayImg = overlay.querySelector('img');
      const overlayKey = overlayImg.getAttribute('data-key');
      const style = getComputedStyle(overlay);
      
      // Get the current positioning
      const currentPos = {
        top: style.top,
        left: style.left,
        width: style.width,
        height: style.height
      };
      
      // Generate code for all Murti images
      let code = `// Add this to your overlayPositions object:\n\n`;
      
      // Add the current murti first
      const murtiName = document.getElementById('murtiImage').src.split('/').pop();
      code += `"Murti_Images/${murtiName}": {\n`;
      code += `  ${overlayKey}: { top: "${currentPos.top}", left: "${currentPos.left}", width: "${currentPos.width}", height: "${currentPos.height}" }\n`;
      code += `},\n\n`;
      
      // Generate code suggesting to add this position for all Ganpati images
      code += `// To use this position for all other Ganpati images, update defaultPositioning:\n\n`;
      code += `defaultPositioning = {\n`;
      code += `  ...defaultPositioning,\n`;
      code += `  ${overlayKey}: { top: "${currentPos.top}", left: "${currentPos.left}", width: "${currentPos.width}", height: "${currentPos.height}" }\n`;
      code += `};\n`;
      
      // Display the code
      const codeOutput = document.getElementById('codeOutput');
      codeOutput.textContent = code;
      codeOutput.style.display = 'block';
      
      // Copy to clipboard without popup
      navigator.clipboard.writeText(code).then(() => {
        showInlineMessage('✓ Batch position code copied to clipboard!');
      }).catch(err => {
        console.error('Could not copy text: ', err);
        showInlineMessage('Code displayed above (copy manually)');
      });
    });

    // Show instructions when page loads
    // window.addEventListener('load', function() {
    //   alert('New Interactive Features Added!\n\n• Drag phetas with the mouse to position them\n• Resize from corners by dragging the small handles\n• Press Alt+A to show/hide adjustment controls\n• Use "Align Center" to center the pheta horizontally\n• Use "Save For All Murtis" to apply the same position to all Ganpati images');
    // });
    
    // Function to show messages inline instead of using alerts
    function showInlineMessage(message) {
      // Create message element if it doesn't exist
      let messageEl = document.getElementById('inlineMessage');
      if (!messageEl) {
        messageEl = document.createElement('div');
        messageEl.id = 'inlineMessage';
        messageEl.style.position = 'fixed';
        messageEl.style.bottom = '70px';
        messageEl.style.left = '50%';
        messageEl.style.transform = 'translateX(-50%)';
        messageEl.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        messageEl.style.color = 'white';
        messageEl.style.padding = '10px 20px';
        messageEl.style.borderRadius = '4px';
        messageEl.style.zIndex = '2000';
        messageEl.style.fontWeight = 'bold';
        document.body.appendChild(messageEl);
      }
      
      // Set message and show
      messageEl.textContent = message;
      messageEl.style.display = 'block';
      
      // Auto-hide after 3 seconds
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 3000);
    }
  </script>

</body>
</html>